<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GRANTOP • Finanças</title>
  <link rel="icon" type="image/png" href="logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="config.js"></script>
  <style>
    body { background-color: #0f172a; color: #e2e8f0; }
    .card { border: 1px solid #1e293b; border-radius: 12px; padding: 16px; }
  </style>
</head>
<body class="min-h-screen">

  <!-- PIN Gate -->
  <div id="pin-gate" style="
    position:fixed; inset:0; z-index:9999; display:flex; align-items:center; justify-content:center;
    background:rgba(0,0,0,.7); backdrop-filter: blur(2px);">
    <div style="width:100%; max-width:360px; background:#0f172a; color:#e2e8f0; border:1px solid #334155; border-radius:12px; padding:18px;">
      <h3 style="margin:0 0 10px; font:600 18px/1.2 ui-sans-serif,system-ui;">Acesso restrito</h3>
      <p style="margin:0 0 12px; opacity:.8; font-size:14px">Informe o PIN para continuar.</p>
      <input id="pin-input" type="password" inputmode="numeric" placeholder="PIN"
            style="width:100%; padding:10px; border-radius:8px; border:1px solid #334155; background:#0b1220; color:#e2e8f0">
      <div style="display:flex; gap:8px; margin-top:12px;">
        <button id="pin-ok" style="flex:1; padding:10px; border-radius:8px; border:1px solid #334155; background:#1f2937; color:#e2e8f0">
          Entrar
        </button>
        <button id="pin-clear" title="Esquecer PIN salvo" style="padding:10px; border-radius:8px; border:1px solid #334155; background:#0b1220; color:#e2e8f0">
          Limpar
        </button>
      </div>
      <div id="pin-err" style="margin-top:10px; color:#fecaca; display:none; font-size:13px;">PIN incorreto.</div>
    </div>
  </div>

  <!-- HEADER -->
  <header class="flex items-center justify-between p-4 bg-slate-900 shadow">
    <div class="flex items-center gap-3">
      <img src="logo.png" alt="GRANTOP" class="h-8 w-auto" />
      <h1 class="text-lg font-bold">GRANTOP • Finanças</h1>
      <span id="status" class="text-sm text-green-400">Conectado</span>
    </div>
    <div class="flex items-center gap-3">
      <input id="mes-vigente" type="month" class="text-slate-900 rounded px-2 py-1" />
      <button onclick="aplicarMes()" class="px-3 py-1 rounded bg-slate-700">Aplicar</button>
      <button onclick="gerarResumo()" class="px-3 py-1 rounded bg-slate-700">Gerar Resumo (planilha)</button>
      <a href="#" onclick="window.location.reload()" class="text-blue-400">Recarregar</a>
    </div>
  </header>

  <!-- CONTEÚDO -->
  <main id="app" class="p-4">
    <div id="totais" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"></div>
    <nav class="flex gap-2 mb-4 flex-wrap">
      <button onclick="showTab('funcionarios')" class="px-3 py-1 rounded bg-slate-700">Funcionários</button>
      <button onclick="showTab('creditos')" class="px-3 py-1 rounded bg-slate-700">Créditos</button>
      <button onclick="showTab('contasfixas')" class="px-3 py-1 rounded bg-slate-700">Contas Fixas</button>
      <button onclick="showTab('contasempresa')" class="px-3 py-1 rounded bg-slate-700">Contas da Empresa</button>
      <button onclick="showTab('impostosparcelados')" class="px-3 py-1 rounded bg-slate-700">Impostos Parcelados</button>
      <button onclick="showTab('impostomes')" class="px-3 py-1 rounded bg-slate-700">Imposto do Mês</button>
      <button onclick="showTab('resumo')" class="px-3 py-1 rounded bg-slate-700">Resumo</button>
    </nav>
    <section id="tab-content" class="card">Selecione uma aba.</section>
  </main>

  <script>
    // --- PIN ---
    const PIN_CODE = '2400';
    const PIN_KEY  = 'grantop_v2_pin';
    const PIN_TTL  = 24*60*60*1000;

    function restorePin() {
      try {
        const raw = localStorage.getItem(PIN_KEY);
        if (!raw) return false;
        const { v, t } = JSON.parse(raw);
        if (v !== PIN_CODE) return false;
        if (Date.now() - t > PIN_TTL) { localStorage.removeItem(PIN_KEY); return false; }
        return true;
      } catch { return false; }
    }
    function savePin() { localStorage.setItem(PIN_KEY, JSON.stringify({ v: PIN_CODE, t: Date.now() })); }

    function requirePin(startAppFn) {
      const gate=document.getElementById('pin-gate');
      const input=document.getElementById('pin-input');
      const ok=document.getElementById('pin-ok');
      const clr=document.getElementById('pin-clear');
      const err=document.getElementById('pin-err');

      function unlock(){ gate.style.display='none'; startAppFn(); }
      function tryEnter(){
        if(input.value.trim()===PIN_CODE){ savePin(); unlock(); }
        else{ err.style.display='block'; input.select(); }
      }

      if(restorePin()){ unlock(); return; }

      gate.style.display='flex'; input.focus();
      ok.onclick=tryEnter; input.onkeydown=(e)=>{if(e.key==='Enter') tryEnter();}
      clr.onclick=()=>{localStorage.removeItem(PIN_KEY); input.value=''; err.style.display='none'; input.focus();}
    }

    // --- APP STUB ---
    function connectAndLoad(){
      document.getElementById('tab-content').innerHTML = "Conexão estabelecida. Escolha uma aba.";
    }
    function aplicarMes(){ alert("Aplicar mês (stub)"); }
    function gerarResumo(){ alert("Gerar resumo (stub)"); }
    function showTab(tab){ document.getElementById('tab-content').innerHTML = "Carregando: "+tab; }

    // Start
    (function init(){ requirePin(connectAndLoad); })();
  </script>
</body>
</html>
